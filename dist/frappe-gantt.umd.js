(function(c,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(c=typeof globalThis<"u"?globalThis:c||self,c.Gantt=u())})(this,function(){"use strict";const c="year",u="month",w="day",M="hour",$="minute",D="second",v="millisecond",h={parse_duration(s){const e=/([0-9]+)(y|m|d|h|min|s|ms)/gm.exec(s);if(e!==null){if(e[2]==="y")return{duration:parseInt(e[1]),scale:"year"};if(e[2]==="m")return{duration:parseInt(e[1]),scale:"month"};if(e[2]==="d")return{duration:parseInt(e[1]),scale:"day"};if(e[2]==="h")return{duration:parseInt(e[1]),scale:"hour"};if(e[2]==="min")return{duration:parseInt(e[1]),scale:"minute"};if(e[2]==="s")return{duration:parseInt(e[1]),scale:"second"};if(e[2]==="ms")return{duration:parseInt(e[1]),scale:"millisecond"}}},parse(s,t="-",e=/[.:]/){if(s instanceof Date)return s;if(typeof s=="string"){let i,n;const a=s.split(" ");i=a[0].split(t).map(o=>parseInt(o,10)),n=a[1]&&a[1].split(e),i[1]=i[1]?i[1]-1:0;let r=i;return n&&n.length&&(n.length===4&&(n[3]="0."+n[3],n[3]=parseFloat(n[3])*1e3),r=r.concat(n)),new Date(...r)}},to_string(s,t=!1){if(!(s instanceof Date))throw new TypeError("Invalid argument type");const e=this.get_date_values(s).map((a,r)=>(r===1&&(a=a+1),r===6?m(a+"",3,"0"):m(a+"",2,"0"))),i=`${e[0]}-${e[1]}-${e[2]}`,n=`${e[3]}:${e[4]}:${e[5]}.${e[6]}`;return i+(t?" "+n:"")},format(s,t="YYYY-MM-DD HH:mm:ss.SSS",e="en"){const i=new Intl.DateTimeFormat(e,{month:"long"}),n=new Intl.DateTimeFormat(e,{month:"short"}),a=i.format(s),r=a.charAt(0).toUpperCase()+a.slice(1),o=this.get_date_values(s).map(_=>m(_,2,0)),p={YYYY:o[0],MM:m(+o[1]+1,2,0),DD:o[2],HH:o[3],mm:o[4],ss:o[5],SSS:o[6],D:o[2],MMMM:r,MMM:n.format(s)};let g=t;const d=[];return Object.keys(p).sort((_,f)=>f.length-_.length).forEach(_=>{g.includes(_)&&(g=g.replaceAll(_,`$${d.length}`),d.push(p[_]))}),d.forEach((_,f)=>{g=g.replaceAll(`$${f}`,_)}),g},diff(s,t,e="day"){let i,n,a,r,o,p,g;i=s-t+(t.getTimezoneOffset()-s.getTimezoneOffset())*6e4,n=i/1e3,r=n/60,a=r/60,o=a/24;let d=s.getFullYear()-t.getFullYear(),_=s.getMonth()-t.getMonth();return _+=o%30/30,p=d*12+_,s.getDate()<t.getDate()&&p--,g=p/12,e.endsWith("s")||(e+="s"),Math.round({milliseconds:i,seconds:n,minutes:r,hours:a,days:o,months:p,years:g}[e]*100)/100},today(){const s=this.get_date_values(new Date).slice(0,3);return new Date(...s)},now(){return new Date},add(s,t,e){t=parseInt(t,10);const i=[s.getFullYear()+(e===c?t:0),s.getMonth()+(e===u?t:0),s.getDate()+(e===w?t:0),s.getHours()+(e===M?t:0),s.getMinutes()+(e===$?t:0),s.getSeconds()+(e===D?t:0),s.getMilliseconds()+(e===v?t:0)];return new Date(...i)},start_of(s,t){const e={[c]:6,[u]:5,[w]:4,[M]:3,[$]:2,[D]:1,[v]:0};function i(a){const r=e[t];return e[a]<=r}const n=[s.getFullYear(),i(c)?0:s.getMonth(),i(u)?1:s.getDate(),i(w)?0:s.getHours(),i(M)?0:s.getMinutes(),i($)?0:s.getSeconds(),i(D)?0:s.getMilliseconds()];return new Date(...n)},clone(s){return new Date(...this.get_date_values(s))},get_date_values(s){return[s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()]},convert_scales(s,t){const e={millisecond:11574074074074074e-24,second:11574074074074073e-21,minute:.0006944444444444445,hour:.041666666666666664,day:1,month:30,year:365},{duration:i,scale:n}=this.parse_duration(s);return i*e[n]/e[t]},get_days_in_month(s){const t=[31,28,31,30,31,30,31,31,30,31,30,31],e=s.getMonth();if(e!==1)return t[e];const i=s.getFullYear();return i%4===0&&i%100!=0||i%400===0?29:28},get_days_in_year(s){return s.getFullYear()%4?365:366}};function m(s,t,e){return s=s+"",t=t>>0,e=String(typeof e<"u"?e:" "),s.length>t?String(s):(t=t-s.length,t>e.length&&(e+=e.repeat(t/e.length)),e.slice(0,t)+String(s))}function k(s,t){const e=document.createElementNS("http://www.w3.org/2000/svg",s);for(let i in t)i==="append_to"?t.append_to.appendChild(e):i==="innerHTML"?e.innerHTML=t.innerHTML:i==="clipPath"?e.setAttribute("clip-path","url(#"+t[i]+")"):e.setAttribute(i,t[i]);return e}class H{constructor(t,e,i){this.gantt=t,this.from_task=e,this.to_task=i,this.calculate_path(),this.draw()}calculate_path(){let t=this.from_task.$bar.getX()+this.from_task.$bar.getWidth()/2;const e=()=>this.to_task.$bar.getX()<t+this.gantt.options.padding&&t>this.from_task.$bar.getX()+this.gantt.options.padding;for(;e();)t-=10;t-=10;let i=this.gantt.config.header_height+this.gantt.options.bar_height+(this.gantt.options.padding+this.gantt.options.bar_height)*this.from_task.task._index+this.gantt.options.padding/2,n=this.to_task.$bar.getX()-13,a=this.gantt.config.header_height+this.gantt.options.bar_height/2+(this.gantt.options.padding+this.gantt.options.bar_height)*this.to_task.task._index+this.gantt.options.padding/2;const r=this.from_task.task._index>this.to_task.task._index;let o=this.gantt.options.arrow_curve;const p=r?1:0;let g=r?-o:o;if(this.to_task.$bar.getX()<=this.from_task.$bar.getX()+this.gantt.options.padding){let d=this.gantt.options.padding/2-o;d<0&&(d=0,o=this.gantt.options.padding/2,g=r?-o:o);const _=this.to_task.$bar.getY()+this.to_task.$bar.getHeight()/2-g,f=this.to_task.$bar.getX()-this.gantt.options.padding;this.path=`
                M ${t} ${i}
                v ${d}
                a ${o} ${o} 0 0 1 ${-o} ${o}
                H ${f}
                a ${o} ${o} 0 0 ${p} ${-o} ${g}
                V ${_}
                a ${o} ${o} 0 0 ${p} ${o} ${g}
                L ${n} ${a}
                m -5 -5
                l 5 5
                l -5 5`}else{n<t+o&&(o=n-t);let d=r?a+o:a-o;this.path=`
              M ${t} ${i}
              V ${d}
              a ${o} ${o} 0 0 ${p} ${o} ${o}
              L ${n} ${a}
              m -5 -5
              l 5 5
              l -5 5`}}draw(){this.element=k("path",{d:this.path,"data-from":this.from_task.task.id,"data-to":this.to_task.task.id})}update(){this.calculate_path(),this.element.setAttribute("d",this.path)}}function y(s){const t=s.getFullYear();return t-t%10+""}function E(s,t,e){let i=h.add(s,6,"day"),n=i.getMonth()!==s.getMonth()?"D MMM":"D",a=!t||s.getMonth()!==t.getMonth()?"D MMM":"D";return`${h.format(s,a,e)} - ${h.format(i,n,e)}`}const l=[{name:"Hour",padding:"7d",step:"1h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(s,t,e)=>!t||s.getDate()!==t.getDate()?h.format(s,"D MMMM",e):"",upper_text_frequency:24},{name:"Quarter Day",padding:"7d",step:"6h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(s,t,e)=>!t||s.getDate()!==t.getDate()?h.format(s,"D MMM",e):"",upper_text_frequency:4},{name:"Half Day",padding:"14d",step:"12h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(s,t,e)=>!t||s.getDate()!==t.getDate()?s.getMonth()!==s.getMonth()?h.format(s,"D MMM",e):h.format(s,"D",e):"",upper_text_frequency:2},{name:"Day",padding:"7d",date_format:"YYYY-MM-DD",step:"1d",lower_text:(s,t,e)=>!t||s.getDate()!==t.getDate()?h.format(s,"D",e):"",upper_text:(s,t,e)=>!t||s.getMonth()!==t.getMonth()?h.format(s,"MMMM",e):"",thick_line:s=>s.getDay()===1},{name:"Week",padding:"1m",step:"7d",date_format:"YYYY-MM-DD",column_width:140,lower_text:E,upper_text:(s,t,e)=>!t||s.getMonth()!==t.getMonth()?h.format(s,"MMMM",e):"",thick_line:s=>s.getDate()>=1&&s.getDate()<=7,upper_text_frequency:4},{name:"Month",padding:"2m",step:"1m",column_width:120,date_format:"YYYY-MM",lower_text:"MMMM",upper_text:(s,t,e)=>!t||s.getFullYear()!==t.getFullYear()?h.format(s,"YYYY",e):"",thick_line:s=>s.getMonth()%3===0,snap_at:"7d"},{name:"Year",padding:"2y",step:"1y",column_width:120,date_format:"YYYY",upper_text:(s,t,e)=>!t||y(s)!==y(t)?y(s):"",lower_text:"YYYY",snap_at:"30d"}],b={arrow_curve:5,auto_move_label:!1,bar_corner_radius:3,bar_height:30,container_height:"auto",column_width:null,date_format:"YYYY-MM-DD HH:mm",upper_header_height:45,lower_header_height:30,snap_at:null,infinite_padding:!0,holidays:{"var(--g-weekend-highlight-color)":"weekend"},ignore:[],language:"en",lines:"both",move_dependencies:!0,padding:18,popup:s=>{s.set_title(s.task.name),s.task.description?s.set_subtitle(s.task.description):s.set_subtitle("");const t=h.format(s.task._start,"MMM D",s.chart.options.language),e=h.format(h.add(s.task._end,-1,"second"),"MMM D",s.chart.options.language);s.set_details(`${t} - ${e} (${s.task.actual_duration} days${s.task.ignored_duration?" + "+s.task.ignored_duration+" excluded":""})<br/>Progress: ${Math.floor(s.task.progress*100)/100}%`)},popup_on:"click",readonly_progress:!1,readonly_dates:!1,readonly:!1,scroll_to:"custom",show_expected_progress:!1,today_button:!0,view_mode:"Day",view_mode_select:!1,view_modes:l,custom_marker:!0,custom_marker_init_date:"2025-04-08T00:00:00Z",player_end_date:"2025-04-17T00:00:00Z",player_button:!0,player_interval:1e3,player_loop:!0,player_use_fa:!0};class Y{constructor(t,e,i){this.options={...b,...i},this.config={step:1,unit:"day",column_width:this.options.column_width||45,header_height:this.options.lower_header_height+this.options.upper_header_height+10,ignored_dates:[],ignored_positions:[],custom_marker_date:new Date(this.options.custom_marker_init_date||Date.now()),player_end_date:this.options.player_end_date?new Date(this.options.player_end_date):null,view_mode:this.options.view_mode},this.setupWrapper(t),this.setupOptions(),this.taskManager=new TaskManager(this),this.taskManager.setupTasks(e),this.gridRenderer=new GridRenderer(this),this.animationManager=new AnimationManager(this),this.eventQueueManager=new EventQueueManager(this),this.eventBinder=new EventBinder(this),this.popupManager=new PopupManager(this),this.layers={},this.dates=[],this.arrows=[],this.changeViewMode(),this.eventBinder.bindEvents(),this.animationManager.initialize()}setupWrapper(t){if(typeof t=="string"&&(t=document.querySelector(t),!t))throw new ReferenceError(`CSS selector "${t}" not found`);if(!(t instanceof HTMLElement)&&!(t instanceof SVGElement))throw new TypeError("Gantt requires a string CSS selector, HTML, or SVG element");this.$svg=t instanceof SVGElement?t:k("svg",{append_to:t,class:"gantt"}),this.$svg.classList.add("gantt"),this.$container=this.createElement({classes:"gantt-container",append_to:this.$svg.parentElement}),this.$container.appendChild(this.$svg),this.$popup_wrapper=this.createElement({classes:"popup-wrapper",append_to:this.$container})}setupOptions(){const t={"grid-height":"container_height","bar-height":"bar_height","lower-header-height":"lower_header_height","upper-header-height":"upper_header_height"};for(const[e,i]of Object.entries(t))this.options[i]!=="auto"&&this.$container.style.setProperty(`--gv-${e}`,`${this.options[i]}px`);this.options.ignore&&(typeof this.options.ignore=="string"?this.config.ignored_dates.push(new Date(this.options.ignore)):Array.isArray(this.options.ignore)?this.options.ignore.forEach(e=>{typeof e=="string"?e==="weekend"?this.config.ignored_function=i=>i.getDay()===6||i.getDay()===0:this.config.ignored_dates.push(new Date(e)):this.config.ignored_function=e}):this.config.ignored_function=this.options.ignore)}changeViewMode(t=this.options.view_mode,e=!1){const i=e?this.$container.scrollLeft:null;this.config.view_mode=typeof t=="string"?this.options.view_modes.find(n=>n.name===t):t,this.options.view_mode=this.config.view_mode.name,this.updateViewScale(),this.setupDates(),this.render(),e&&(this.$container.scrollLeft=i),this.triggerEvent("view_change",[this.config.view_mode])}updateViewScale(){const{duration:t,scale:e}=h.parse_duration(this.config.view_mode.step);this.config.step=t,this.config.unit=e,this.config.column_width=this.options.column_width||this.config.view_mode.column_width||45,this.$container.style.setProperty("--gv-column-width",`${this.config.column_width}px`)}setupDates(){const t=this.taskManager.tasks;this.gantt_start=t.length?t.reduce((i,n)=>n._start<i?n._start:i,t[0]._start):new Date,this.gantt_end=t.length?t.reduce((i,n)=>n._end>i?n._end:i,t[0]._end):new Date,this.gantt_start=h.start_of(this.gantt_start,this.config.unit),this.gantt_end=h.start_of(this.gantt_end,this.config.unit),this.gantt_start=h.add(this.gantt_start,-1,this.config.unit),this.gantt_end=h.add(this.gantt_end,1,this.config.unit),this.dates=[this.gantt_start];let e=this.gantt_start;for(;e<this.gantt_end;)e=h.add(e,this.config.step,this.config.unit),this.dates.push(e)}render(){this.clear(),this.setupLayers(),this.gridRenderer.renderGrid(),this.taskManager.makeBars(),this.makeArrows(),this.setDimensions(),this.animationManager.playAnimatedHighlight()}setupLayers(){["grid","arrow","progress","bar"].forEach(t=>{this.layers[t]=k("g",{class:t,append_to:this.$svg})}),this.$extras=this.createElement({classes:"extras",append_to:this.$container}),this.$adjust=this.createElement({classes:"adjust hide",append_to:this.$extras,type:"button",textContent:"←"})}makeArrows(){this.arrows=[];for(const t of this.taskManager.tasks){const e=t.dependencies.map(i=>{const n=this.taskManager.getTask(i);if(!n)return null;const a=new H(this,this.taskManager.getBar(n.id),this.taskManager.getBar(t.id));return this.layers.arrow.appendChild(a.element),a}).filter(Boolean);this.arrows.push(...e)}this.taskManager.bars.forEach(t=>{t.arrows=this.arrows.filter(e=>e.from_task.task.id===t.task.id||e.to_task.task.id===t.task.id)})}setDimensions(){var e;const t=((e=this.$svg.querySelector(".grid .grid-row"))==null?void 0:e.getAttribute("width"))||0;this.$svg.setAttribute("width",t)}scrollCurrent(){const t=new Date;if(t<this.gantt_start||t>this.gantt_end)return;const e=h.diff(t,this.gantt_start,this.config.unit)/this.config.step*this.config.column_width;this.$container.scrollTo({left:e-this.config.column_width/6,behavior:"smooth"})}scrollToLatestTask(){if(!this.taskManager.tasks.length)return;const t=this.taskManager.tasks.reduce((i,n)=>n._start<i._start?n:i,this.taskManager.tasks[0]),e=this.config.header_height+t._index*(this.options.bar_height+this.options.padding);this.$container.scrollTo({top:e-this.config.header_height,behavior:"smooth"})}getDatesToDraw(){let t=null;return this.dates.map(e=>{const i=this.getDateInfo(e,t);return t=i,i})}getDateInfo(t,e){var r,o,p,g;const i=e?e.x+e.column_width:0,n=typeof this.config.view_mode.upper_text=="string"?h.format(t,this.config.view_mode.upper_text,this.options.language):((o=(r=this.config.view_mode).upper_text)==null?void 0:o.call(r,t,e==null?void 0:e.date,this.options.language))||"",a=typeof this.config.view_mode.lower_text=="string"?h.format(t,this.config.view_mode.lower_text,this.options.language):((g=(p=this.config.view_mode).lower_text)==null?void 0:g.call(p,t,e==null?void 0:e.date,this.options.language))||"";return{date:t,formatted_date:T(h.format(t,this.config.view_mode.date_format||this.options.date_format,this.options.language)),column_width:this.config.column_width,x:i,upper_text:n,lower_text:a,upper_y:17,lower_y:this.options.upper_header_height+5}}createElement({classes:t="",append_to:e,type:i="div",textContent:n,...a}){const r=document.createElement(i);return t.split(" ").forEach(o=>o&&r.classList.add(o)),Object.assign(r.style,a),n&&(r.textContent=n),e&&e.appendChild(r),r}getSnapPosition(t,e){const i=this.options.snap_at?h.parse_duration(this.options.snap_at).duration:1,n=t%(this.config.column_width/i);return e+(t-n+(n<this.config.column_width/i*2?0:this.config.column_width/i))}viewIs(t){return typeof t=="string"?this.config.view_mode.name===t:Array.isArray(t)?t.includes(this.config.view_mode.name):this.config.view_mode.name===t.name}triggerEvent(t,e){this.options[`on_${t}`]&&this.options[`on_${t}`].apply(this,e)}clear(){var t,e,i,n,a;this.$svg.innerHTML="",(t=this.$header)==null||t.remove(),(e=this.$sideHeader)==null||e.remove(),(i=this.$currentHighlight)==null||i.remove(),(n=this.$currentBallHighlight)==null||n.remove(),(a=this.$extras)==null||a.remove(),this.popupManager.hide(),this.animationManager.stopAnimations()}}Y.VIEW_MODE={HOUR:l[0],QUARTER_DAY:l[1],HALF_DAY:l[2],DAY:l[3],WEEK:l[4],MONTH:l[5],YEAR:l[6]};function T(s){return s.replaceAll(" ","_").replaceAll(":","_").replaceAll(".","_")}return Y});
