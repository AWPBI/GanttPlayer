(function(m,w){typeof exports=="object"&&typeof module<"u"?module.exports=w():typeof define=="function"&&define.amd?define(w):(m=typeof globalThis<"u"?globalThis:m||self,m.Gantt=w())})(this,function(){"use strict";const m="year",w="month",$="day",b="hour",v="minute",k="second",D="millisecond",d={parse_duration(n){const e=/([0-9]+)(y|m|d|h|min|s|ms)/gm.exec(n);if(e!==null){if(e[2]==="y")return{duration:parseInt(e[1]),scale:"year"};if(e[2]==="m")return{duration:parseInt(e[1]),scale:"month"};if(e[2]==="d")return{duration:parseInt(e[1]),scale:"day"};if(e[2]==="h")return{duration:parseInt(e[1]),scale:"hour"};if(e[2]==="min")return{duration:parseInt(e[1]),scale:"minute"};if(e[2]==="s")return{duration:parseInt(e[1]),scale:"second"};if(e[2]==="ms")return{duration:parseInt(e[1]),scale:"millisecond"}}},parse(n,t="-",e=/[.:]/){if(n instanceof Date)return n;if(typeof n=="string"){let i,s;const a=n.split(" ");i=a[0].split(t).map(o=>parseInt(o,10)),s=a[1]&&a[1].split(e),i[1]=i[1]?i[1]-1:0;let r=i;return s&&s.length&&(s.length===4&&(s[3]="0."+s[3],s[3]=parseFloat(s[3])*1e3),r=r.concat(s)),new Date(...r)}},to_string(n,t=!1){if(!(n instanceof Date))throw new TypeError("Invalid argument type");const e=this.get_date_values(n).map((a,r)=>(r===1&&(a=a+1),r===6?y(a+"",3,"0"):y(a+"",2,"0"))),i=`${e[0]}-${e[1]}-${e[2]}`,s=`${e[3]}:${e[4]}:${e[5]}.${e[6]}`;return i+(t?" "+s:"")},format(n,t="YYYY-MM-DD HH:mm:ss.SSS",e="en"){const i=new Intl.DateTimeFormat(e,{month:"long"}),s=new Intl.DateTimeFormat(e,{month:"short"}),a=i.format(n),r=a.charAt(0).toUpperCase()+a.slice(1),o=this.get_date_values(n).map(u=>y(u,2,0)),l={YYYY:o[0],MM:y(+o[1]+1,2,0),DD:o[2],HH:o[3],mm:o[4],ss:o[5],SSS:o[6],D:o[2],MMMM:r,MMM:s.format(n)};let h=t;const g=[];return Object.keys(l).sort((u,p)=>p.length-u.length).forEach(u=>{h.includes(u)&&(h=h.replaceAll(u,`$${g.length}`),g.push(l[u]))}),g.forEach((u,p)=>{h=h.replaceAll(`$${p}`,u)}),h},diff(n,t,e="day"){let i,s,a,r,o,l,h;i=n-t+(t.getTimezoneOffset()-n.getTimezoneOffset())*6e4,s=i/1e3,r=s/60,a=r/60,o=a/24;let g=n.getFullYear()-t.getFullYear(),u=n.getMonth()-t.getMonth();return u+=o%30/30,l=g*12+u,n.getDate()<t.getDate()&&l--,h=l/12,e.endsWith("s")||(e+="s"),Math.round({milliseconds:i,seconds:s,minutes:r,hours:a,days:o,months:l,years:h}[e]*100)/100},today(){const n=this.get_date_values(new Date).slice(0,3);return new Date(...n)},now(){return new Date},add(n,t,e){t=parseInt(t,10);const i=[n.getFullYear()+(e===m?t:0),n.getMonth()+(e===w?t:0),n.getDate()+(e===$?t:0),n.getHours()+(e===b?t:0),n.getMinutes()+(e===v?t:0),n.getSeconds()+(e===k?t:0),n.getMilliseconds()+(e===D?t:0)];return new Date(...i)},start_of(n,t){const e={[m]:6,[w]:5,[$]:4,[b]:3,[v]:2,[k]:1,[D]:0};function i(a){const r=e[t];return e[a]<=r}const s=[n.getFullYear(),i(m)?0:n.getMonth(),i(w)?1:n.getDate(),i($)?0:n.getHours(),i(b)?0:n.getMinutes(),i(v)?0:n.getSeconds(),i(k)?0:n.getMilliseconds()];return new Date(...s)},clone(n){return new Date(...this.get_date_values(n))},get_date_values(n){return[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()]},convert_scales(n,t){const e={millisecond:11574074074074074e-24,second:11574074074074073e-21,minute:.0006944444444444445,hour:.041666666666666664,day:1,month:30,year:365},{duration:i,scale:s}=this.parse_duration(n);return i*e[s]/e[t]},get_days_in_month(n){const t=[31,28,31,30,31,30,31,31,30,31,30,31],e=n.getMonth();if(e!==1)return t[e];const i=n.getFullYear();return i%4===0&&i%100!=0||i%400===0?29:28},get_days_in_year(n){return n.getFullYear()%4?365:366}};function y(n,t,e){return n=n+"",t=t>>0,e=String(typeof e<"u"?e:" "),n.length>t?String(n):(t=t-n.length,t>e.length&&(e+=e.repeat(t/e.length)),e.slice(0,t)+String(n))}function _(n,t){return typeof n=="string"?(t||document).querySelector(n):n||null}function c(n,t){const e=document.createElementNS("http://www.w3.org/2000/svg",n);for(let i in t)i==="append_to"?t.append_to.appendChild(e):i==="innerHTML"?e.innerHTML=t.innerHTML:i==="clipPath"?e.setAttribute("clip-path","url(#"+t[i]+")"):e.setAttribute(i,t[i]);return e}function x(n,t,e,i){const s=T(n,t,e,i);if(s===n){const a=document.createEvent("HTMLEvents");a.initEvent("click",!0,!0),a.eventName="click",s.dispatchEvent(a)}}function T(n,t,e,i,s="0.4s",a="0.1s"){const r=n.querySelector("animate");if(r)return _.attr(r,{attributeName:t,from:e,to:i,dur:s,begin:"click + "+a}),n;const o=c("animate",{attributeName:t,from:e,to:i,dur:s,begin:a,calcMode:"spline",values:e+";"+i,keyTimes:"0; 1",keySplines:E("ease-out")});return n.appendChild(o),n}function E(n){return{ease:".25 .1 .25 1",linear:"0 0 1 1","ease-in":".42 0 1 1","ease-out":"0 0 .58 1","ease-in-out":".42 0 .58 1"}[n]}_.on=(n,t,e,i)=>{i?_.delegate(n,t,e,i):(i=e,_.bind(n,t,i))},_.off=(n,t,e)=>{n.removeEventListener(t,e)},_.bind=(n,t,e)=>{t.split(/\s+/).forEach(function(i){n.addEventListener(i,e)})},_.delegate=(n,t,e,i)=>{n.addEventListener(t,function(s){const a=s.target.closest(e);a&&(s.delegatedTarget=a,i.call(this,s,a))})},_.closest=(n,t)=>t?t.matches(n)?t:_.closest(n,t.parentNode):null,_.attr=(n,t,e)=>{if(!e&&typeof t=="string")return n.getAttribute(t);if(typeof t=="object"){for(let i in t)_.attr(n,i,t[i]);return}n.setAttribute(t,e)};class H{constructor(t,e,i){this.gantt=t,this.from_task=e,this.to_task=i,this.calculate_path(),this.draw()}calculate_path(){let t=this.from_task.$bar.getX()+this.from_task.$bar.getWidth()/2;const e=()=>this.to_task.$bar.getX()<t+this.gantt.options.padding&&t>this.from_task.$bar.getX()+this.gantt.options.padding;for(;e();)t-=10;t-=10;let i=this.gantt.config.header_height+this.gantt.options.bar_height+(this.gantt.options.padding+this.gantt.options.bar_height)*this.from_task.task._index+this.gantt.options.padding/2,s=this.to_task.$bar.getX()-13,a=this.gantt.config.header_height+this.gantt.options.bar_height/2+(this.gantt.options.padding+this.gantt.options.bar_height)*this.to_task.task._index+this.gantt.options.padding/2;const r=this.from_task.task._index>this.to_task.task._index;let o=this.gantt.options.arrow_curve;const l=r?1:0;let h=r?-o:o;if(this.to_task.$bar.getX()<=this.from_task.$bar.getX()+this.gantt.options.padding){let g=this.gantt.options.padding/2-o;g<0&&(g=0,o=this.gantt.options.padding/2,h=r?-o:o);const u=this.to_task.$bar.getY()+this.to_task.$bar.getHeight()/2-h,p=this.to_task.$bar.getX()-this.gantt.options.padding;this.path=`
                M ${t} ${i}
                v ${g}
                a ${o} ${o} 0 0 1 ${-o} ${o}
                H ${p}
                a ${o} ${o} 0 0 ${l} ${-o} ${h}
                V ${u}
                a ${o} ${o} 0 0 ${l} ${o} ${h}
                L ${s} ${a}
                m -5 -5
                l 5 5
                l -5 5`}else{s<t+o&&(o=s-t);let g=r?a+o:a-o;this.path=`
              M ${t} ${i}
              V ${g}
              a ${o} ${o} 0 0 ${l} ${o} ${o}
              L ${s} ${a}
              m -5 -5
              l 5 5
              l -5 5`}}draw(){this.element=c("path",{d:this.path,"data-from":this.from_task.task.id,"data-to":this.to_task.task.id})}update(){this.calculate_path(),this.element.setAttribute("d",this.path)}}class Y{constructor(t,e){this.set_defaults(t,e),this.prepare_wrappers(),this.prepare_helpers(),this.refresh()}refresh(){this.bar_group.innerHTML="",this.handle_group.innerHTML="",this.task.custom_class?this.group.classList.add(this.task.custom_class):this.group.classList=["bar-wrapper"],this.prepare_values(),this.draw(),this.bind()}set_defaults(t,e){this.action_completed=!1,this.gantt=t,this.task=e,this.name=this.name||""}prepare_wrappers(){this.group=c("g",{class:"bar-wrapper"+(this.task.custom_class?" "+this.task.custom_class:""),"data-id":this.task.id}),this.bar_group=c("g",{class:"bar-group",append_to:this.group}),this.handle_group=c("g",{class:"handle-group",append_to:this.group})}prepare_values(){this.invalid=this.task.invalid,this.height=this.gantt.options.bar_height,this.image_size=this.height-5,this.task._start=new Date(this.task.start),this.task._end=new Date(this.task.end),this.compute_x(),this.compute_y(),this.compute_duration(),this.corner_radius=this.gantt.options.bar_corner_radius,this.width=this.gantt.config.column_width*this.duration,(!this.task.progress||this.task.progress<0)&&(this.task.progress=0),this.task.progress>100&&(this.task.progress=100)}prepare_helpers(){SVGElement.prototype.getX=function(){return+this.getAttribute("x")},SVGElement.prototype.getY=function(){return+this.getAttribute("y")},SVGElement.prototype.getWidth=function(){return+this.getAttribute("width")},SVGElement.prototype.getHeight=function(){return+this.getAttribute("height")},SVGElement.prototype.getEndX=function(){return this.getX()+this.getWidth()}}prepare_expected_progress_values(){this.compute_expected_progress(),this.expected_progress_width=this.gantt.options.column_width*this.duration*(this.expected_progress/100)||0}draw(){this.draw_bar(),this.draw_progress_bar(),this.gantt.options.show_expected_progress&&(this.prepare_expected_progress_values(),this.draw_expected_progress_bar()),this.draw_label(),this.draw_resize_handles(),this.task.thumbnail&&this.draw_thumbnail()}draw_bar(){this.$bar=c("rect",{x:this.x,y:this.y,width:this.width,height:this.height,rx:this.corner_radius,ry:this.corner_radius,class:"bar",append_to:this.bar_group}),this.task.color&&(this.$bar.style.fill=this.task.color),x(this.$bar,"width",0,this.width),this.invalid&&this.$bar.classList.add("bar-invalid")}draw_expected_progress_bar(){this.invalid||(this.$expected_bar_progress=c("rect",{x:this.x,y:this.y,width:this.expected_progress_width,height:this.height,rx:this.corner_radius,ry:this.corner_radius,class:"bar-expected-progress",append_to:this.bar_group}),x(this.$expected_bar_progress,"width",0,this.expected_progress_width))}draw_progress_bar(){if(this.invalid)return;this.progress_width=this.calculate_progress_width();let t=this.corner_radius;/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(t=this.corner_radius+2),this.$bar_progress=c("rect",{x:this.x,y:this.y,width:this.progress_width,height:this.height,rx:t,ry:t,class:"bar-progress",append_to:this.bar_group}),this.task.color_progress&&(this.$bar_progress.style.fill=this.task.color_progress);const e=d.diff(this.task._start,this.gantt.gantt_start,this.gantt.config.unit)/this.gantt.config.step*this.gantt.config.column_width;let i=this.gantt.create_el({classes:`date-range-highlight hide highlight-${this.task.id}`,width:this.width,left:e});this.$date_highlight=i,this.gantt.$lower_header.prepend(this.$date_highlight),x(this.$bar_progress,"width",0,this.progress_width)}calculate_progress_width(){const t=this.$bar.getWidth(),e=this.x+t,i=this.gantt.config.ignored_positions.reduce((l,h)=>l+(h>=this.x&&h<e),0)*this.gantt.config.column_width;let s=(t-i)*this.task.progress/100;const a=this.x+s,r=this.gantt.config.ignored_positions.reduce((l,h)=>l+(h>=this.x&&h<a),0)*this.gantt.config.column_width;s+=r;let o=this.gantt.get_ignored_region(this.x+s);for(;o.length;)s+=this.gantt.config.column_width,o=this.gantt.get_ignored_region(this.x+s);return this.progress_width=s,s}draw_label(){let t=this.x+this.$bar.getWidth()/2;this.task.thumbnail&&(t=this.x+this.image_size+5),c("text",{x:t,y:this.y+this.height/2,innerHTML:this.task.name,class:"bar-label",append_to:this.bar_group}),requestAnimationFrame(()=>this.update_label_position())}draw_thumbnail(){let t=10,e=2,i,s;i=c("defs",{append_to:this.bar_group}),c("rect",{id:"rect_"+this.task.id,x:this.x+t,y:this.y+e,width:this.image_size,height:this.image_size,rx:"15",class:"img_mask",append_to:i}),s=c("clipPath",{id:"clip_"+this.task.id,append_to:i}),c("use",{href:"#rect_"+this.task.id,append_to:s}),c("image",{x:this.x+t,y:this.y+e,width:this.image_size,height:this.image_size,class:"bar-img",href:this.task.thumbnail,clipPath:"clip_"+this.task.id,append_to:this.bar_group})}draw_resize_handles(){if(this.invalid||this.gantt.options.readonly)return;const t=this.$bar,e=3;if(this.handles=[],this.gantt.options.readonly_dates||(this.handles.push(c("rect",{x:t.getEndX()-e/2,y:t.getY()+this.height/4,width:e,height:this.height/2,rx:2,ry:2,class:"handle right",append_to:this.handle_group})),this.handles.push(c("rect",{x:t.getX()-e/2,y:t.getY()+this.height/4,width:e,height:this.height/2,rx:2,ry:2,class:"handle left",append_to:this.handle_group}))),!this.gantt.options.readonly_progress){const i=this.$bar_progress;this.$handle_progress=c("circle",{cx:i.getEndX(),cy:i.getY()+i.getHeight()/2,r:4.5,class:"handle progress",append_to:this.handle_group}),this.handles.push(this.$handle_progress)}for(let i of this.handles)_.on(i,"mouseenter",()=>i.classList.add("active")),_.on(i,"mouseleave",()=>i.classList.remove("active"))}bind(){this.invalid||this.setup_click_event()}setup_click_event(){let t=this.task.id;_.on(this.group,"mouseover",s=>{this.gantt.trigger_event("hover",[this.task,s.screenX,s.screenY,s])}),this.gantt.options.popup_on==="click"&&_.on(this.group,"mouseup",s=>{const a=s.offsetX||s.layerX;if(this.$handle_progress){const r=+this.$handle_progress.getAttribute("cx");if(r>a-1&&r<a+1||this.gantt.bar_being_dragged)return}this.gantt.show_popup({x:s.offsetX||s.layerX,y:s.offsetY||s.layerY,task:this.task,target:this.$bar})});let e;_.on(this.group,"mouseenter",s=>{e=setTimeout(()=>{this.gantt.options.popup_on==="hover"&&this.gantt.show_popup({x:s.offsetX||s.layerX,y:s.offsetY||s.layerY,task:this.task,target:this.$bar}),this.gantt.$container.querySelector(`.highlight-${t}`).classList.remove("hide")},200)}),_.on(this.group,"mouseleave",()=>{var s,a;clearTimeout(e),this.gantt.options.popup_on==="hover"&&((a=(s=this.gantt.popup)==null?void 0:s.hide)==null||a.call(s)),this.gantt.$container.querySelector(`.highlight-${t}`).classList.add("hide")}),_.on(this.group,"click",()=>{this.gantt.trigger_event("click",[this.task])}),_.on(this.group,"dblclick",s=>{this.action_completed||(this.group.classList.remove("active"),this.gantt.popup&&this.gantt.popup.parent.classList.remove("hide"),this.gantt.trigger_event("double_click",[this.task]))});let i=!1;_.on(this.group,"touchstart",s=>{if(!i)return i=!0,setTimeout(function(){i=!1},300),!1;s.preventDefault(),!this.action_completed&&(this.group.classList.remove("active"),this.gantt.popup&&this.gantt.popup.parent.classList.remove("hide"),this.gantt.trigger_event("double_click",[this.task]))})}update_bar_position({x:t=null,width:e=null}){const i=this.$bar;if(t){if(!this.task.dependencies.map(r=>this.gantt.get_bar(r).$bar.getX()).reduce((r,o)=>r&&t>=o,!0))return;this.update_attr(i,"x",t),this.x=t,this.$date_highlight.style.left=t+"px"}e>0&&(this.update_attr(i,"width",e),this.$date_highlight.style.width=e+"px"),this.update_label_position(),this.update_handle_position(),this.date_changed(),this.compute_duration(),this.gantt.options.show_expected_progress&&this.update_expected_progressbar_position(),this.update_progressbar_position(),this.update_arrow_position()}update_label_position_on_horizontal_scroll({x:t,sx:e}){const i=this.gantt.$container.querySelector(".gantt-container"),s=this.group.querySelector(".bar-label"),a=this.group.querySelector(".bar-img")||"",r=this.bar_group.querySelector(".img_mask")||"";let o=this.$bar.getX()+this.$bar.getWidth(),l=s.getX()+t,h=a&&a.getX()+t||0,g=a&&a.getBBox().width+7||7,u=l+s.getBBox().width+7,p=e+i.clientWidth/2;s.classList.contains("big")||(u<o&&t>0&&u<p||l-g>this.$bar.getX()&&t<0&&u>p)&&(s.setAttribute("x",l),a&&(a.setAttribute("x",h),r.setAttribute("x",h)))}date_changed(){let t=!1;const{new_start_date:e,new_end_date:i}=this.compute_start_end_date();Number(this.task._start)!==Number(e)&&(t=!0,this.task._start=e),Number(this.task._end)!==Number(i)&&(t=!0,this.task._end=i),t&&this.gantt.trigger_event("date_change",[this.task,e,d.add(i,-1,"second")])}progress_changed(){this.task.progress=this.compute_progress(),this.gantt.trigger_event("progress_change",[this.task,this.task.progress])}set_action_completed(){this.action_completed=!0,setTimeout(()=>this.action_completed=!1,1e3)}compute_start_end_date(){const t=this.$bar,e=t.getX()/this.gantt.config.column_width;let i=d.add(this.gantt.gantt_start,e*this.gantt.config.step,this.gantt.config.unit);const s=t.getWidth()/this.gantt.config.column_width,a=d.add(i,s*this.gantt.config.step,this.gantt.config.unit);return{new_start_date:i,new_end_date:a}}compute_progress(){this.progress_width=this.$bar_progress.getWidth(),this.x=this.$bar_progress.getBBox().x;const t=this.x+this.progress_width,e=this.progress_width-this.gantt.config.ignored_positions.reduce((s,a)=>s+(a>=this.x&&a<=t),0)*this.gantt.config.column_width;if(e<0)return 0;const i=this.$bar.getWidth()-this.ignored_duration_raw*this.gantt.config.column_width;return parseInt(e/i*100,10)}compute_expected_progress(){this.expected_progress=d.diff(d.today(),this.task._start,"hour")/this.gantt.config.step,this.expected_progress=(this.expected_progress<this.duration?this.expected_progress:this.duration)*100/this.duration}compute_x(){const{column_width:t}=this.gantt.config,e=this.task._start,i=this.gantt.gantt_start;let a=d.diff(e,i,this.gantt.config.unit)/this.gantt.config.step*t;this.x=a}compute_y(){this.y=this.gantt.config.header_height+this.gantt.options.padding/2+this.task._index*(this.height+this.gantt.options.padding)}compute_duration(){let t=0,e=0;for(let i=new Date(this.task._start);i<this.task._end;i.setDate(i.getDate()+1))e++,!this.gantt.config.ignored_dates.find(s=>s.getTime()===i.getTime())&&(!this.gantt.config.ignored_function||!this.gantt.config.ignored_function(i))&&t++;this.task.actual_duration=t,this.task.ignored_duration=e-t,this.duration=d.convert_scales(e+"d",this.gantt.config.unit)/this.gantt.config.step,this.actual_duration_raw=d.convert_scales(t+"d",this.gantt.config.unit)/this.gantt.config.step,this.ignored_duration_raw=this.duration-this.actual_duration_raw}update_attr(t,e,i){return i=+i,isNaN(i)||t.setAttribute(e,i),t}update_expected_progressbar_position(){this.invalid||(this.$expected_bar_progress.setAttribute("x",this.$bar.getX()),this.compute_expected_progress(),this.$expected_bar_progress.setAttribute("width",this.gantt.config.column_width*this.actual_duration_raw*(this.expected_progress/100)||0))}update_progressbar_position(){this.invalid||this.gantt.options.readonly||(this.$bar_progress.setAttribute("x",this.$bar.getX()),this.$bar_progress.setAttribute("width",this.calculate_progress_width()))}update_label_position(){const t=this.bar_group.querySelector(".img_mask")||"",e=this.$bar,i=this.group.querySelector(".bar-label"),s=this.group.querySelector(".bar-img");let a=5,r=this.image_size+10;const o=i.getBBox().width,l=e.getWidth();o>l?(i.classList.add("big"),s?(s.setAttribute("x",e.getEndX()+a),t.setAttribute("x",e.getEndX()+a),i.setAttribute("x",e.getEndX()+r)):i.setAttribute("x",e.getEndX()+a)):(i.classList.remove("big"),s?(s.setAttribute("x",e.getX()+a),t.setAttribute("x",e.getX()+a),i.setAttribute("x",e.getX()+l/2+r)):i.setAttribute("x",e.getX()+l/2-o/2))}update_handle_position(){if(this.invalid||this.gantt.options.readonly)return;const t=this.$bar;this.handle_group.querySelector(".handle.left").setAttribute("x",t.getX()),this.handle_group.querySelector(".handle.right").setAttribute("x",t.getEndX());const e=this.group.querySelector(".handle.progress");e&&e.setAttribute("cx",this.$bar_progress.getEndX())}update_arrow_position(){this.arrows=this.arrows||[];for(let t of this.arrows)t.update()}}class S{constructor(t,e,i){this.parent=t,this.popup_func=e,this.gantt=i,this.make()}make(){this.parent.innerHTML=`
            <div class="title"></div>
            <div class="subtitle"></div>
            <div class="details"></div>
            <div class="actions"></div>
        `,this.hide(),this.title=this.parent.querySelector(".title"),this.subtitle=this.parent.querySelector(".subtitle"),this.details=this.parent.querySelector(".details"),this.actions=this.parent.querySelector(".actions")}show({x:t,y:e,task:i,target:s}){this.actions.innerHTML="";let a=this.popup_func({task:i,chart:this.gantt,get_title:()=>this.title,set_title:r=>this.title.innerHTML=r,get_subtitle:()=>this.subtitle,set_subtitle:r=>this.subtitle.innerHTML=r,get_details:()=>this.details,set_details:r=>this.details.innerHTML=r,add_action:(r,o)=>{let l=this.gantt.create_el({classes:"action-btn",type:"button",append_to:this.actions});typeof r=="function"&&(r=r(i)),l.innerHTML=r,l.onclick=h=>o(i,this.gantt,h)}});a!==!1&&(a&&(this.parent.innerHTML=a),this.actions.innerHTML===""?this.actions.remove():this.parent.appendChild(this.actions),this.parent.style.left=t+10+"px",this.parent.style.top=e-10+"px",this.parent.classList.remove("hide"))}hide(){this.parent.classList.add("hide")}}function M(n){const t=n.getFullYear();return t-t%10+""}function L(n,t,e){let i=d.add(n,6,"day"),s=i.getMonth()!==n.getMonth()?"D MMM":"D",a=!t||n.getMonth()!==t.getMonth()?"D MMM":"D";return`${d.format(n,a,e)} - ${d.format(i,s,e)}`}const f=[{name:"Hour",padding:"7d",step:"1h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(n,t,e)=>!t||n.getDate()!==t.getDate()?d.format(n,"D MMMM",e):"",upper_text_frequency:24},{name:"Quarter Day",padding:"7d",step:"6h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(n,t,e)=>!t||n.getDate()!==t.getDate()?d.format(n,"D MMM",e):"",upper_text_frequency:4},{name:"Half Day",padding:"14d",step:"12h",date_format:"YYYY-MM-DD HH:",lower_text:"HH",upper_text:(n,t,e)=>!t||n.getDate()!==t.getDate()?n.getMonth()!==n.getMonth()?d.format(n,"D MMM",e):d.format(n,"D",e):"",upper_text_frequency:2},{name:"Day",padding:"7d",date_format:"YYYY-MM-DD",step:"1d",lower_text:(n,t,e)=>!t||n.getDate()!==t.getDate()?d.format(n,"D",e):"",upper_text:(n,t,e)=>!t||n.getMonth()!==t.getMonth()?d.format(n,"MMMM",e):"",thick_line:n=>n.getDay()===1},{name:"Week",padding:"1m",step:"7d",date_format:"YYYY-MM-DD",column_width:140,lower_text:L,upper_text:(n,t,e)=>!t||n.getMonth()!==t.getMonth()?d.format(n,"MMMM",e):"",thick_line:n=>n.getDate()>=1&&n.getDate()<=7,upper_text_frequency:4},{name:"Month",padding:"2m",step:"1m",column_width:120,date_format:"YYYY-MM",lower_text:"MMMM",upper_text:(n,t,e)=>!t||n.getFullYear()!==t.getFullYear()?d.format(n,"YYYY",e):"",thick_line:n=>n.getMonth()%3===0,snap_at:"7d"},{name:"Year",padding:"2y",step:"1y",column_width:120,date_format:"YYYY",upper_text:(n,t,e)=>!t||M(n)!==M(t)?M(n):"",lower_text:"YYYY",snap_at:"30d"}],B={arrow_curve:5,auto_move_label:!1,bar_corner_radius:3,bar_height:30,container_height:"auto",column_width:null,date_format:"YYYY-MM-DD HH:mm",upper_header_height:45,lower_header_height:30,snap_at:null,infinite_padding:!0,holidays:{"var(--g-weekend-highlight-color)":"weekend"},ignore:[],language:"en",lines:"both",move_dependencies:!0,padding:18,popup:n=>{n.set_title(n.task.name),n.task.description?n.set_subtitle(n.task.description):n.set_subtitle("");const t=d.format(n.task._start,"MMM D",n.chart.options.language),e=d.format(d.add(n.task._end,-1,"second"),"MMM D",n.chart.options.language);n.set_details(`${t} - ${e} (${n.task.actual_duration} days${n.task.ignored_duration?" + "+n.task.ignored_duration+" excluded":""})<br/>Progress: ${Math.floor(n.task.progress*100)/100}%`)},popup_on:"click",readonly_progress:!1,readonly_dates:!1,readonly:!1,scroll_to:"custom",show_expected_progress:!1,today_button:!0,view_mode:"Day",view_mode_select:!1,view_modes:f,custom_marker:!0,custom_marker_init_date:"2025-04-08T00:00:00Z",player_end_date:"2025-04-17T00:00:00Z",player_button:!0,player_interval:1e3,player_loop:!0,player_use_fa:!0};class X{constructor(t){this.gantt=t,this.$animatedHighlight=null,this.$animatedBallHighlight=null,this.scrollAnimationFrame=null,this.playerInterval=null}initialize(){if(!this.gantt.options.custom_marker)return;const{config:t,gantt_start:e}=this.gantt;t.custom_marker_date=new Date(t.custom_marker_date||e),this.playAnimatedHighlight()}playAnimatedHighlight(){const{gantt:t}=this,{config:e,options:i,$container:s,$header:a,grid_height:r}=t,o=d.diff(e.custom_marker_date,t.gantt_start,e.unit)/e.step*e.column_width;if(this.$animatedHighlight?(this.$animatedHighlight.style.left=`${o}px`,this.$animatedBallHighlight.style.left=`${o-2}px`):(this.$animatedHighlight=t.createElement({top:e.header_height,left:o,width:2,height:r-e.header_height,classes:"animated-highlight",append_to:s,style:"background: var(--g-custom-highlight); z-index: 999;"}),this.$animatedBallHighlight=t.createElement({top:e.header_height-6,left:o-2,width:6,height:6,classes:"animated-ball-highlight",append_to:a,style:"background: var(--g-custom-highlight); border-radius: 50%; z-index: 1001;"})),i.player_state){const l=(i.player_interval||1e3)/1e3,h=e.column_width;[this.$animatedHighlight,this.$animatedBallHighlight].forEach(g=>{g.style.setProperty("--animation-duration",`${l}s`),g.style.setProperty("--move-distance",`${h}px`),g.style.animation="none",g.offsetHeight,g.style.animation=`moveRight ${l}s linear forwards`,g.style.animationPlayState="running"})}}playerUpdate(){const{gantt:t}=this,{config:e,options:i,eventQueueManager:s}=t;if(!i.player_state)return;const a=e.player_end_date?d.parse(e.player_end_date,"YYYY-MM-DD"):null;if(a&&e.custom_marker_date>=a){this.stop();return}const r=new Date(e.custom_marker_date);e.custom_marker_date=d.add(e.custom_marker_date,e.step,e.unit);const o=d.diff(e.custom_marker_date,t.gantt_start,e.unit)/e.step*e.column_width;if(this.playAnimatedHighlight(),this.startScrollAnimation(o),i.custom_marker){t.taskManager.tasks.filter(p=>p._start>=r&&p._start<e.custom_marker_date||p._end>r&&p._end<=e.custom_marker_date||p._start<=e.custom_marker_date&&e.custom_marker_date<p._end).forEach(p=>{s.overlappingTasks.has(p.id)||s.addEvent("bar_enter",p)});const h=new Set(t.taskManager.tasks.filter(p=>p._start<=e.custom_marker_date&&e.custom_marker_date<p._end).map(p=>p.id)),g=[...h].filter(p=>!s.overlappingTasks.has(p)),u=[...s.overlappingTasks].filter(p=>!h.has(p));g.forEach(p=>s.addEvent("bar_enter",t.taskManager.getTask(p))),u.forEach(p=>s.addEvent("bar_exit",t.taskManager.getTask(p))),s.overlappingTasks=h}}startScrollAnimation(t){if(this.scrollAnimationFrame&&cancelAnimationFrame(this.scrollAnimationFrame),!this.gantt.options.player_state)return;const e=(this.gantt.options.player_interval||1e3)/1e3,i=performance.now(),s=this.gantt.$container,a=s.clientWidth,r=s.scrollWidth-a,o=a/6,l=h=>{if(!this.gantt.options.player_state)return;const g=Math.min((h-i)/1e3/e,1),u=t+this.gantt.config.column_width*g;s.scrollLeft=Math.max(0,Math.min(u-o,r)),g<1?this.scrollAnimationFrame=requestAnimationFrame(l):(this.scrollAnimationFrame=null,this.gantt.config.player_end_date&&this.gantt.config.custom_marker_date>=this.gantt.config.player_end_date&&this.stop())};this.scrollAnimationFrame=requestAnimationFrame(l)}stop(){const{gantt:t}=this;clearInterval(this.playerInterval),this.playerInterval=null,this.stopAnimations(),t.options.player_state=!1,t.eventQueueManager.overlappingTasks.clear(),t.eventQueueManager.eventQueue=[],t.$playerButton&&(t.options.player_use_fa?(t.$playerButton.classList.remove("fa-pause"),t.$playerButton.classList.add("fa-play")):t.$playerButton.textContent="Play"),t.triggerEvent("finish",[])}stopAnimations(){this.$animatedHighlight&&(this.$animatedHighlight.style.animationPlayState="paused"),this.$animatedBallHighlight&&(this.$animatedBallHighlight.style.animationPlayState="paused"),this.scrollAnimationFrame&&(cancelAnimationFrame(this.scrollAnimationFrame),this.scrollAnimationFrame=null)}togglePlay(){const{gantt:t}=this;t.options.player_state=!t.options.player_state,t.options.player_state?(t.eventQueueManager.initialize(),this.playerInterval=setInterval(()=>this.playerUpdate(),t.options.player_interval||1e3),t.triggerEvent("start",[]),t.$playerButton&&(t.options.player_use_fa?(t.$playerButton.classList.remove("fa-play"),t.$playerButton.classList.add("fa-pause")):t.$playerButton.textContent="Pause"),this.playAnimatedHighlight()):this.stop()}reset(){const{gantt:t}=this;t.config.custom_marker_date=new Date(t.options.custom_marker_init_date||t.gantt_start),this.stop(),t.render(),this.playAnimatedHighlight(),t.triggerEvent("reset",[])}}class F{constructor(t){this.gantt=t,this.eventQueue=[],this.overlappingTasks=new Set,this.isProcessingQueue=!1}async processQueue(t=!1){if(this.isProcessingQueue&&!t)return;this.isProcessingQueue=!0;const e=[...this.eventQueue];this.eventQueue=[];for(const{event:i,task:s}of e)try{await this.gantt.options[`on_${i}`](s)}catch(a){console.error(`Error processing ${i} for task ${s.id}:`,a)}this.isProcessingQueue=!1}addEvent(t,e){this.eventQueue.push({event:t,task:e}),this.overlappingTasks.add(e.id),this.processQueue()}initialize(){if(!this.gantt.options.custom_marker)return;const t=this.gantt.config.custom_marker_date,e=this.gantt.taskManager.tasks.filter(i=>i._start<=t&&t<i._end).map(i=>i.id);e.forEach(i=>{this.overlappingTasks.has(i)||this.addEvent("bar_enter",this.gantt.taskManager.getTask(i))}),this.overlappingTasks=new Set(e),this.processQueue()}}class W{constructor(t){this.gantt=t}renderGrid(){this.makeBackground(),this.makeRows(),this.makeHeader(),this.makeTicks(),this.makeHighlights()}makeBackground(){const{gantt:t}=this,e=t.dates.length*t.config.column_width,i=Math.max(t.config.header_height+t.options.padding+(t.options.bar_height+t.options.padding)*t.taskManager.tasks.length,t.options.container_height!=="auto"?t.options.container_height:0);c("rect",{x:0,y:0,width:e,height:i,class:"grid-background",append_to:t.$svg}),_.attr(t.$svg,{height:i,width:"100%"}),t.grid_height=i,t.options.container_height==="auto"&&(t.$container.style.height=`${i+16}px`)}makeRows(){const{gantt:t}=this,e=c("g",{append_to:t.layers.grid}),i=t.dates.length*t.config.column_width,s=t.options.bar_height+t.options.padding;for(let a=t.config.header_height;a<t.grid_height;a+=s)c("rect",{x:0,y:a,width:i,height:s,class:"grid-row",append_to:e})}makeHeader(){const{gantt:t}=this;t.$header=t.createElement({width:t.dates.length*t.config.column_width,classes:"grid-header",append_to:t.$container}),t.$upperHeader=t.createElement({classes:"upper-header",append_to:t.$header}),t.$lowerHeader=t.createElement({classes:"lower-header",append_to:t.$header}),this.makeSideHeader(),this.makeDates()}makeSideHeader(){const{gantt:t}=this;if(t.$sideHeader=t.createElement({classes:"side-header",append_to:t.$upperHeader}),t.options.view_mode_select){const e=document.createElement("select");e.classList.add("viewmode-select"),e.innerHTML="<option selected disabled>Mode</option>"+t.options.view_modes.map(i=>`<option value="${i.name}"${i.name===t.config.view_mode.name?" selected":""}>${i.name}</option>`).join(""),e.addEventListener("change",()=>t.changeViewMode(e.value,!0)),t.$sideHeader.appendChild(e)}t.options.today_button&&(t.$todayButton=t.createElement({type:"button",classes:"today-button",append_to:t.$sideHeader,textContent:"Today"}),t.$todayButton.onclick=()=>t.scrollCurrent()),t.options.player_button&&(t.$playerResetButton=t.createElement({type:"button",classes:"player-reset-button",append_to:t.$sideHeader,textContent:t.options.player_use_fa?"":"Reset"}),t.options.player_use_fa&&t.$playerResetButton.classList.add("fas","fa-redo"),t.$playerResetButton.onclick=()=>t.animationManager.reset(),t.$playerButton=t.createElement({type:"button",classes:"player-button",append_to:t.$sideHeader,textContent:t.options.player_use_fa?"":"Play"}),t.options.player_use_fa&&t.$playerButton.classList.add("fas",t.options.player_state?"fa-pause":"fa-play"),t.$playerButton.onclick=()=>t.animationManager.togglePlay())}makeDates(){const{gantt:t}=this;t.getDatesToDraw().forEach(e=>{e.lower_text&&t.createElement({left:e.x,top:e.lower_y,classes:`lower-text date_${sanitize(e.formatted_date)}`,append_to:t.$lowerHeader,textContent:e.lower_text}),e.upper_text&&t.createElement({left:e.x,top:e.upper_y,classes:"upper-text",append_to:t.$upperHeader,textContent:e.upper_text})}),t.upperTexts=Array.from(t.$container.querySelectorAll(".upper-text"))}makeTicks(){const{gantt:t}=this;if(t.options.lines==="none")return;const e=c("g",{class:"lines_layer",append_to:t.layers.grid}),i=t.dates.length*t.config.column_width,s=t.options.bar_height+t.options.padding;if(t.options.lines!=="vertical"){let a=t.config.header_height;for(;a<t.grid_height;)c("line",{x1:0,y1:a+s,x2:i,y2:a+s,class:"row-line",append_to:e}),a+=s}if(t.options.lines!=="horizontal"){let a=0;t.dates.forEach(r=>{const o=t.config.view_mode.thick_line&&t.config.view_mode.thick_line(r)?"tick thick":"tick";c("path",{d:`M ${a} ${t.config.header_height} v ${t.grid_height-t.config.header_height}`,class:o,append_to:t.layers.grid}),a+=t.viewIs("month")?d.get_days_in_month(r)*t.config.column_width/30:t.viewIs("year")?d.get_days_in_year(r)*t.config.column_width/365:t.config.column_width})}}makeHighlights(){const{gantt:t}=this;if(t.options.holidays)for(const[i,s]of Object.entries(t.options.holidays)){let a=typeof s=="string"&&s==="weekend"?r=>r.getDay()===0||r.getDay()===6:Array.isArray(s)?r=>s.some(o=>new Date(o.date+" ").getTime()===r.getTime()):s;for(let r=new Date(t.gantt_start);r<=t.gantt_end;r.setDate(r.getDate()+1))if(!(t.config.ignored_dates.some(o=>o.getTime()===r.getTime())||t.config.ignored_function&&t.config.ignored_function(r))&&a(r)){const o=d.diff(r,t.gantt_start,t.config.unit)/t.config.step*t.config.column_width;c("rect",{x:Math.round(o),y:t.config.header_height,width:t.config.column_width/d.convert_scales(t.config.view_mode.step,"day"),height:t.grid_height-t.config.header_height,class:`holiday-highlight ${sanitize(d.format(r,"YYYY-MM-DD",t.options.language))}`,style:`fill: ${i};`,append_to:t.layers.grid})}}const e=new Date;if(e>=t.gantt_start&&e<=t.gantt_end){const i=d.diff(e,t.gantt_start,t.config.unit)/t.config.step*t.config.column_width;t.$currentHighlight=t.createElement({top:t.config.header_height,left:i,height:t.grid_height-t.config.header_height,classes:"current-highlight",append_to:t.$container}),t.$currentBallHighlight=t.createElement({top:t.config.header_height-6,left:i-2.5,width:6,height:6,classes:"current-ball-highlight",append_to:t.$header})}}}function N(n){return`${n.name}_${Math.random().toString(36).slice(2,12)}`}function C(n){return n.replaceAll(" ","_").replaceAll(":","_").replaceAll(".","_")}class P{constructor(t){this.gantt=t,this.tasks=[],this.bars=[],this.dependencyMap={}}setupTasks(t){console.log("Raw tasks:",t),this.tasks=t.map((e,i)=>{if(!e||typeof e!="object")return console.error(`Task at index ${i} is invalid: ${JSON.stringify(e)}`),null;if(!e.start)return console.error(`Task "${e.id||i}" doesn't have a start date`),null;if(!e.end&&e.duration===void 0)return console.error(`Task "${e.id||i}" doesn't have an end date or duration`),null;if((!e.name||typeof e.name!="string")&&(console.warn(`Task "${e.id||i}" missing name, using default`),e.name=`Task ${i+1}`),e._start=d.parse(e.start),!e._start||isNaN(e._start.getTime()))return console.warn(`Task "${e.id||i}" has invalid start date: ${e.start}`),null;if(e.end===void 0&&e.duration!==void 0?(e._end=new Date(e._start),e.duration.split(" ").forEach(o=>{let{duration:l,scale:h}=d.parse_duration(o);if(isNaN(l)||!h)return console.error(`Task "${e.id||i}" has invalid duration: ${o}`),null;e._end=d.add(e._end,l,h)}),e.end=e._end.toString()):e.end&&(e._end=d.parse(e.end)),!e._end||isNaN(e._end.getTime()))return console.warn(`Task "${e.id||i}" has invalid end date: ${e.end}`),null;let s=d.diff(e._end,e._start,"year");if(s<0)return console.error(`Start of task can't be after end of task: in task "${e.id||i}"`),null;if(s>10)return console.error(`The duration of task "${e.id||i}" is too long (above ten years)`),null;if(d.get_date_values(e._end).slice(3).every(r=>r===0)&&(e._end=d.add(e._end,24,"hour"),e.end=e._end.toString()),e._index=i,typeof e.dependencies=="string"||!e.dependencies){let r=[];e.dependencies&&(r=e.dependencies.split(",").map(o=>o.trim().replaceAll(" ","_")).filter(o=>o)),e.dependencies=r}return e.id?typeof e.id=="string"?e.id=e.id.replaceAll(" ","_"):e.id=`${e.id}`:e.id=N(e),e}).filter(e=>e!=null),console.log("Processed tasks:",this.tasks),this.tasks.length||console.warn("No valid tasks provided; Gantt chart may be empty"),this.setupDependencies()}setupDependencies(){this.dependencyMap={};for(const t of this.tasks)for(const e of t.dependencies)this.dependencyMap[e]=this.dependencyMap[e]||[],this.dependencyMap[e].push(t.id)}makeBars(){this.bars=this.tasks.map(t=>{try{const e=new Y(this.gantt,t);return this.gantt.layers.bar.appendChild(e.group),e}catch(e){return console.error(`Failed to create bar for task "${t.id}":`,e),null}}).filter(Boolean)}getTask(t){return this.tasks.find(e=>e.id===t)}getBar(t){return this.bars.find(e=>e.task.id===t)}updateTask(t,e){const i=this.getTask(t),s=this.getBar(t);if(!i||!s){console.error(`Task or bar with id "${t}" not found`);return}Object.assign(i,e),s.refresh()}refresh(t){this.setupTasks(t),this.gantt.render()}}class q{constructor(t){this.gantt=t}bindEvents(){this.bindGridClick(),this.bindBarEvents(),this.bindHolidayLabels()}bindGridClick(){_.on(this.gantt.$container,"click",".grid-row, .grid-header, .ignored-bar, .holiday-highlight",()=>{this.gantt.popupManager.hide(),this.gantt.$container.querySelectorAll(".bar-wrapper").forEach(t=>t.classList.remove("active"))})}bindHolidayLabels(){const t=this.gantt.$container.querySelectorAll(".holiday-highlight");for(const e of t){const i=this.gantt.$container.querySelector(`.label_${e.classList[1]}`);if(!i)continue;let s;e.onmouseenter=a=>{s=setTimeout(()=>{i.classList.add("show"),i.style.left=`${a.offsetX||a.layerX}px`,i.style.top=`${a.offsetY||a.layerY}px`},300)},e.onmouseleave=()=>{clearTimeout(s),i.classList.remove("show")}}}bindBarEvents(){let t=!1,e=!1,i=!1,s=0,a=null,r=[];_.on(this.gantt.$svg,"mousedown",".bar-wrapper, .handle",(o,l)=>{const h=_.closest(".bar-wrapper",l);l.classList.contains("left")?(e=!0,l.classList.add("visible")):l.classList.contains("right")?(i=!0,l.classList.add("visible")):t=!0,this.gantt.popupManager.hide(),s=o.offsetX||o.layerX,a=h.getAttribute("data-id"),r=(this.gantt.options.move_dependencies?[a,...this.getAllDependentTasks(a)]:[a]).map(g=>this.gantt.taskManager.getBar(g)),r.forEach(g=>{g.$bar.ox=g.$bar.getX(),g.$bar.owidth=g.$bar.getWidth(),g.$bar.finaldx=0})}),_.on(this.gantt.$svg,"mousemove",o=>{if(!(t||e||i))return;const l=(o.offsetX||o.layerX)-s;r.forEach(h=>{h.$bar.finaldx=this.gantt.getSnapPosition(l,h.$bar.ox),this.gantt.popupManager.hide(),e&&h.task.id===a?h.update_bar_position({x:h.$bar.ox+h.$bar.finaldx,width:h.$bar.owidth-h.$bar.finaldx}):i&&h.task.id===a?h.update_bar_position({width:h.$bar.owidth+h.$bar.finaldx}):t&&!this.gantt.options.readonly&&!this.gantt.options.readonly_dates&&h.update_bar_position({x:h.$bar.ox+h.$bar.finaldx})})}),document.addEventListener("mouseup",()=>{var o;t=e=i=!1,(o=this.gantt.$container.querySelector(".visible"))==null||o.classList.remove("visible"),r.forEach(l=>{l.$bar.finaldx&&(l.date_changed(),l.compute_progress(),l.set_action_completed())}),r=[]})}getAllDependentTasks(t){const e=[];let i=[t];for(;i.length;){const s=i.reduce((a,r)=>a.concat(this.gantt.taskManager.dependencyMap[r]||[]),[]);e.push(...s),i=s.filter(a=>!i.includes(a))}return e.filter(Boolean)}}class z{constructor(t){this.gantt=t,this.popup=null}show(t){this.gantt.options.popup!==!1&&(this.popup||(this.popup=new S(this.gantt.$popup_wrapper,this.gantt.options.popup,this.gantt)),this.popup.show(t))}hide(){this.popup&&this.popup.hide()}}class A{constructor(t,e,i){this.options={...B,...i},this.options.view_modes=Array.isArray(this.options.view_modes)?this.options.view_modes:f,typeof this.options.view_mode=="string"?this.options.view_mode=this.options.view_modes.find(s=>s.name===this.options.view_mode)||f.find(s=>s.name==="DAY"):(!this.options.view_mode||typeof this.options.view_mode!="object")&&(this.options.view_mode=f.find(s=>s.name==="DAY")),(!Array.isArray(this.options.view_mode.padding)||!this.options.view_mode.padding.every(s=>typeof s=="string"&&s.trim()))&&(this.options.view_mode.padding=["1 day","1 day"]),this.config={step:1,unit:"day",column_width:this.options.column_width||this.options.view_mode.column_width||45,header_height:this.options.lower_header_height+this.options.upper_header_height+10,ignored_dates:[],ignored_positions:[],custom_marker_date:this.options.custom_marker_init_date?d.parse(this.options.custom_marker_init_date):new Date,player_end_date:this.options.player_end_date?d.parse(this.options.player_end_date):null,extend_by_units:10},this.setupWrapper(t),this.setupOptions(),this.taskManager=new P(this),this.taskManager.setupTasks(e),this.gridRenderer=new W(this),this.animationManager=new X(this),this.eventQueueManager=new F(this),this.eventBinder=new q(this),this.popupManager=new z(this),this.layers={},this.dates=[],this.arrows=[],this.setupDates(),this.changeViewMode(),this.eventBinder.bindEvents(),this.animationManager.initialize()}setupWrapper(t){if(typeof t=="string"&&(t=document.querySelector(t),!t))throw new ReferenceError(`CSS selector "${t}" not found`);if(!(t instanceof HTMLElement)&&!(t instanceof SVGElement))throw new TypeError("Gantt requires a string CSS selector, HTML, or SVG element");this.$svg=t instanceof SVGElement?t:c("svg",{append_to:t,class:"gantt"}),this.$svg.classList.add("gantt"),this.$container=this.createElement({classes:"gantt-container",append_to:this.$svg.parentElement}),this.$container.appendChild(this.$svg),this.$popup_wrapper=this.createElement({classes:"popup-wrapper",append_to:this.$container})}setupOptions(){const t={"grid-height":"container_height","bar-height":"bar_height","lower-header-height":"lower_header_height","upper-header-height":"upper_header_height"};for(const[e,i]of Object.entries(t))this.options[i]!=="auto"&&this.$container.style.setProperty(`--gv-${e}`,`${this.options[i]}px`);this.options.ignore&&(typeof this.options.ignore=="string"?this.config.ignored_dates.push(d.parse(this.options.ignore)):Array.isArray(this.options.ignore)?this.options.ignore.forEach(e=>{if(typeof e=="string")if(e==="weekend")this.config.ignored_function=i=>i.getDay()===6||i.getDay()===0;else{const i=d.parse(e);i&&!isNaN(i.getTime())&&this.config.ignored_dates.push(i)}else this.config.ignored_function=e}):this.config.ignored_function=this.options.ignore)}changeViewMode(t=this.options.view_mode,e=!1){const i=e?this.$container.scrollLeft:null;let s;typeof t=="string"?s=this.options.view_modes.find(a=>a.name===t)||f.find(a=>a.name==="DAY"):s=t&&typeof t=="object"?t:f.find(a=>a.name==="DAY"),(!Array.isArray(s.padding)||!s.padding.every(a=>typeof a=="string"&&a.trim()))&&(s.padding=["1 day","1 day"]),this.options.view_mode=s,this.updateViewScale(),this.setupDates(),this.render(),e&&(this.$container.scrollLeft=i),this.triggerEvent("view_change",[this.options.view_mode])}updateViewScale(){const{duration:t,scale:e}=d.parse_duration(this.options.view_mode.step);this.config.step=t,this.config.unit=e,this.config.column_width=this.options.column_width||this.options.view_mode.column_width||45,this.$container.style.setProperty("--gv-column-width",`${this.config.column_width}px`)}setupDates(t=!1){const e=this.taskManager.tasks;let i,s;if(!e.length)console.warn("No valid tasks; using current date as fallback"),i=new Date,s=new Date;else for(let r of e)(!i||r._start<i)&&(i=r._start),(!s||r._end>s)&&(s=r._end);if(i=d.start_of(i,this.config.unit),s=d.start_of(s,this.config.unit),t)this.gantt_start=i,this.gantt_end=s;else if(this.options.infinite_padding)this.gantt_start=d.add(i,-this.config.extend_by_units*3,this.config.unit),this.gantt_end=d.add(s,this.config.extend_by_units*3,this.config.unit);else{const r=Array.isArray(this.options.view_mode.padding)?this.options.view_mode.padding:["1 day","1 day"];let[o,l]=r.map(h=>{const g=d.parse_duration(h);return g&&typeof g=="object"&&g.duration&&g.scale?g:{duration:1,scale:"day"}});this.gantt_start=d.add(i,-o.duration,o.scale),this.gantt_end=d.add(s,l.duration,l.scale)}this.gantt_start.setHours(0,0,0,0),this.dates=[this.gantt_start];let a=this.gantt_start;for(;a<this.gantt_end;)a=d.add(a,this.config.step,this.config.unit),this.dates.push(a)}render(){this.clear(),this.setupLayers(),this.gridRenderer.renderGrid(),this.taskManager.makeBars(),this.makeArrows(),this.setDimensions(),this.animationManager.playAnimatedHighlight()}setupLayers(){["grid","arrow","progress","bar"].forEach(t=>{this.layers[t]=c("g",{class:t,append_to:this.$svg})}),this.$extras=this.createElement({classes:"extras",append_to:this.$container}),this.$adjust=this.createElement({classes:"adjust hide",append_to:this.$extras,type:"button",textContent:"â†"})}makeArrows(){this.arrows=[];for(const t of this.taskManager.tasks){const e=t.dependencies.map(i=>{const s=this.taskManager.getTask(i);if(!s)return null;const a=new H(this,this.taskManager.getBar(s.id),this.taskManager.getBar(t.id));return this.layers.arrow.appendChild(a.element),a}).filter(Boolean);this.arrows.push(...e)}this.taskManager.bars.forEach(t=>{t.arrows=this.arrows.filter(e=>e.from_task.task.id===t.task.id||e.to_task.task.id===t.task.id)})}setDimensions(){var e;const t=((e=this.$svg.querySelector(".grid .grid-row"))==null?void 0:e.getAttribute("width"))||0;this.$svg.setAttribute("width",t)}scrollCurrent(){const t=new Date;if(t<this.gantt_start||t>this.gantt_end)return;const e=d.diff(t,this.gantt_start,this.config.unit)/this.config.step*this.config.column_width;this.$container.scrollTo({left:e-this.config.column_width/6,behavior:"smooth"})}scrollToLatestTask(){if(!this.taskManager.tasks.length)return;const t=this.taskManager.tasks.reduce((i,s)=>s._start<i._start?s:i,this.taskManager.tasks[0]),e=this.config.header_height+t._index*(this.options.bar_height+this.options.padding);this.$container.scrollTo({top:e-this.config.header_height,behavior:"smooth"})}getDatesToDraw(){let t=null;return this.dates.map(e=>{const i=this.getDateInfo(e,t);return t=i,i})}getDateInfo(t,e){var r,o,l,h;const i=e?e.x+e.column_width:0,s=typeof this.options.view_mode.upper_text=="string"?d.format(t,this.options.view_mode.upper_text,this.options.language):((o=(r=this.options.view_mode).upper_text)==null?void 0:o.call(r,t,e==null?void 0:e.date,this.options.language))||"",a=typeof this.options.view_mode.lower_text=="string"?d.format(t,this.options.view_mode.lower_text,this.options.language):((h=(l=this.options.view_mode).lower_text)==null?void 0:h.call(l,t,e==null?void 0:e.date,this.options.language))||"";return{date:t,formatted_date:C(d.format(t,this.options.view_mode.date_format||this.options.date_format,this.options.language)),column_width:this.config.column_width,x:i,upper_text:s,lower_text:a,upper_y:17,lower_y:this.options.upper_header_height+5}}createElement({classes:t="",append_to:e,type:i="div",textContent:s,...a}){const r=document.createElement(i);return t.split(" ").forEach(o=>o&&r.classList.add(o)),Object.assign(r.style,a),s&&(r.textContent=s),e&&e.appendChild(r),r}getSnapPosition(t,e){const i=this.options.snap_at?d.parse_duration(this.options.snap_at).duration:1,s=t%(this.config.column_width/i);return e+(t-s+(s<this.config.column_width/i*2?0:this.config.column_width/i))}viewIs(t){return typeof t=="string"?this.options.view_mode.name===t:Array.isArray(t)?t.includes(this.options.view_mode.name):this.options.view_mode.name===t.name}triggerEvent(t,e){this.options[`on_${t}`]&&this.options[`on_${t}`].apply(this,e)}clear(){var t,e,i,s,a;this.$svg.innerHTML="",(t=this.$header)==null||t.remove(),(e=this.$sideHeader)==null||e.remove(),(i=this.$currentHighlight)==null||i.remove(),(s=this.$currentBallHighlight)==null||s.remove(),(a=this.$extras)==null||a.remove(),this.popupManager.hide(),this.animationManager.stopAnimations()}show_popup(t){this.popupManager.show(t)}get_ignored_region(t){return this.config.ignored_positions.filter(e=>e>=t&&e<t+this.config.column_width)}create_el(t){return this.createElement(t)}update_options(t){this.options={...this.options,...t},this.setupOptions(),this.changeViewMode()}}return A.VIEW_MODE={HOUR:f[0],QUARTER_DAY:f[1],HALF_DAY:f[2],DAY:f[3],WEEK:f[4],MONTH:f[5],YEAR:f[6]},A});
